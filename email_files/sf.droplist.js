define("starfield/sf.droplist",["jq!starfield/jquery.mod","css!starfield/sf.droplist.css","css!starfield/sf.core.css","starfield/sf.util","domReady!"],function(){return function(d){$sf.util.selector("sf-droplist",{root:{selector:".sf-droplist",states:{open:function(a){return a.sfDropList("isOpen")},closed:function(a){return!a.sfDropList("isOpen")}},tests:{id:function(a,b){return a.attr("id")===b}}}});return $sf.util.module("DropList",{options:{selectedIndex:0,width:250,listWidth:void 0,listMaxHeight:void 0,
listHeight:void 0,autoOpen:!1,valueChangeElement:void 0,onOpen:void 0,onClose:void 0,onValueChanged:void 0,ensureTopZIndex:!1,zIndex:void 0,disabled:!1},_create:function(){this._width=this.options.width;this._listWidth=this.options.listWidth?this.options.listWidth:this._width;this._enabled=this.options.disabled!==!0;this._createMain();if(this.options.valueChangeElement&&this.options.valueChangeElement.length>0)this.valueChangeElement=d(this.options.valueChangeElement);this._createDropDown();var a=
this.list.children("[data-selected]");a.length===0&&(a=this.list.children("li").eq(this.options.selectedIndex));a.length===0&&(a=this.list.children("li").first());this.selectItem(a,!0);this.options.autoOpen===!0&&this.open()},_createMain:function(){this.element.wrap('<div class="'+this.baseClass+'-select" />');this.box=this.element.parent();this.box.css({width:this._width-38+"px"});this._enabled||this.box.addClass(this.baseClass+"-select-disabled");this.boxContent=d('<div class="'+this.baseClass+
'-selectcontent"></div>').append('<div class="'+this.baseClass+'-display"></div>').prependTo(this.box);this.anchor=d('<div class="sf-droplist-selectbtn"><span class="'+this.baseClass+'-anchor"></span></div>').appendTo(this.box);this.list=this.element;this.list.addClass(this.baseClass).hide()},_createDropDown:function(){var a=this,b={display:"none",position:"absolute","overflow-x":"hidden"};typeof a.options.listHeight==="number"?(b.height=a.options.listHeight+"px",b["overflow-y"]="auto"):typeof a.options.listMaxHeight===
"number"?(b["max-height"]=a.options.listMaxHeight+"px",b["overflow-y"]="auto"):b["overflow-y"]="hidden";a.drop=d('<div class="sf-droplist-drop"></div>').appendTo(document.body).width(a._listWidth).append(a.list).css(b);a.list.show();a.anchor.bind("click",function(){a._enabled&&a.toggle()});a.boxContent.bind("click",function(){a._enabled&&a.toggle()});a.box.parents().add(window).bind("scroll.sfdl",function(){a.close()});d(window).bind("click.sfdl",function(b){a._blur(d(b.target))});a._attachItemClickHandler(a.list.children("li"))},
_attachItemClickHandler:function(a){var b=this;a.click(function(){b.selectItem(d(this));b.close()})},_positionList:function(){var a=this,b=a.box.offset(),c={top:b.top-a.drop.outerHeight()+1,bottom:b.top+a.box.outerHeight()-1},b={left:b.left+"px",top:function(b){var f=d(window).scrollTop(),f={top:f,bottom:f+d(window).height()};return(b+a.drop.outerHeight())*-1<f.bottom*-1?c.top:b}(c.bottom)+"px"};if(!isNaN(a.options.zIndex))b.zIndex=a.options.zIndex;if(a.options.ensureTopZIndex===!0){var g=$sf.util.util({logId:a.id});
b.zIndex=g.zIndex.max()+3}a.drop.css(b)},_blur:function(a){var b=a.is(this.box);b||(b=this.box.find(a).length>0);b||this.close()},destroy:function(a){this.isOpen()&&this.close();this.boxContent.unbind();this.anchor.unbind();this.list.removeClass(this.baseClass).hide().insertBefore(this.box).children().removeClass("sf-droplist-actv").unbind();this.box.parents().unbind("scroll.sfdl");this.box.remove();d(window).unbind("scroll.sfdl").unbind("click.sfdl");this.drop.remove();this._execSuper("destroy",
a)},selectItem:function(a,b){var c,g=this.selectedIndex();if(d.isPlainObject(a))a=a.item,b=a.forceRefresh;if(typeof a==="number")c=this.list.children("li:eq("+a+")");else if(a.length===0)return a;else c=a;if(b||g!==c.index()){this.boxContent.children().addClass("old").end().prepend("<div>"+c.children("[data-main]").html()+"</div>").children(".old").remove();this.list.children("li").removeAttr("data-selected").removeClass("sf-droplist-actv");c.attr("data-selected",!0).addClass("sf-droplist-actv");
var e=c.attr("data-value");this.list.attr("data-value",e);if(!b&&d.isFunction(this.options.onValueChanged))this.options.onValueChanged(this.element,c,e);(c=this.valueChangeElement)&&c.length>0&&c.each(function(){d(this).is("input")?d(this).val(e):d(this).text(e)})}},selectItemByValue:function(a,b){if(d.isPlainObject(a))a=a.value,b=a.forceRefresh;var c=this.list.children('li[data-value="'+a+'"]');c.length>0&&this.selectItem(c,b)},open:function(){var a=this;a._positionList();a.drop.show();d(":sf-droplist(open)").not(a.element).sfDropList("close");
d(window).bind("resize.sfdl"+a.id.replace(/-_/g,""),function(){a.isOpen()&&a._positionList()});if(d.isFunction(a.options.onOpen))a.options.onOpen(a.element)},close:function(){var a=!0;d.isFunction(this.options.onClose)&&(a=this.options.onClose(this.element));a&&(this.drop.hide(),d(window).unbind("resize.sfdl"+this.id.replace(/-_/g,"")))},toggle:function(){this.isOpen()?this.close():this.open()},addItem:function(a){var b,c,g,e,f;if(!a)throw"You must provide arguments indicating what you'd like to add to the droplist.";
typeof a==="object"?(c=a.html,b=a.text||a.value,g=a.value||a.text,e=a.index,f=a.classes):g=b=a.toString();a=d("<li/>").attr("data-value",g);c?(a.html(c),a.find("[data-main]").length||a.children().first().attr("data-main","true")):b&&a.append(d('<div data-main="true"/>').text(b));f&&a.addClass(f);e===0?a.prependTo(this.list):e?this.list.find("li:nth-child("+(e+1)+")").before(a):a.appendTo(this.list);this._attachItemClickHandler(a)},removeItem:function(a){var b,c;typeof a==="number"?b=a:typeof a===
"string"?c=a:"index"in a?b=+a.index:c=a.value;b===void 0?(a='li[data-value="'+c+'"]',b=c==this.val()):(a="li:nth-child("+(b+1)+")",b=b==this.selectedIndex());this.list.find(a).remove();b&&this.selectItem(0)},enable:function(){this.box.removeClass(this.baseClass+"-select-disabled");this._enabled=!0},disable:function(){this.close();this.box.addClass(this.baseClass+"-select-disabled");this._enabled=!1},isOpen:function(){return this.drop.is(":visible")},val:function(){return this.list.children("li[data-selected]").attr("data-value")},
selectedItem:function(){return this.list.children("li[data-selected]")},selectedIndex:function(){return this.list.children("li[data-selected]").index()},box:function(){return this.box}})}($sf.getjQuery())});
